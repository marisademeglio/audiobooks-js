<!DOCTYPE html>
<html>
    <head>
        <title>audiobooks-js example</title>
        <style>
            input {
                width: 20vw;
            }
            code em {
                font-weight: bold;
            }
        </style>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/default.min.css">
        <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
        <script src="../build/audiobooks.js" type="module"></script>
        <script src="../lib/moment.js"></script>
        <script type="module">
            import { Manifest } from '../build/audiobooks.js';
            var manifest;
            document.addEventListener("DOMContentLoaded", () => {
                let inputFile = new URL("pub/manifest.json", document.location.href).href;
                document.querySelector("#inputFile").setAttribute('value', inputFile);
                
                manifest = new Manifest();
                // do a little setup
                manifest.setSupportedProfiles([{
                    id: "https://www.w3.org/TR/pub-manifest/",
                    encodingFormats: ['text/html']
                },
                {
                    id: "https://www.w3.org/TR/audiobooks/",
                    encodingFormats: ['audio/mpeg']
                }]);
                manifest.setDefaults({direction: 'ltr'});
                document.querySelector("#version").textContent = manifest.version;

                let urlSearchParams = new URLSearchParams(document.location.search);
                if (urlSearchParams.has("q")) {
                    loadManifest(urlSearchParams.get("q"));
                }
            });

            document.querySelector("#load").addEventListener('click', async e => {
                await loadManifest(document.querySelector("#inputFile").value);
            });

            async function loadManifest(url) {
                clearAll();
                
                // load a file
                await manifest.loadUrl(url);
                
                let errorText = manifest.errors.length > 0 ? 
                    JSON.stringify(manifest.errors, null, 2) : "No errors";
                document.querySelector("#status").innerHTML = 
                        `Processed Document. \nErrors(s):\n${errorText}`;
                document.querySelector("#data").innerHTML = JSON.stringify(manifest.data, null, 2);
                
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightBlock(block);
                });
            }

            function clearAll() {
                document.querySelector("#status").innerHTML = '';
                document.querySelector("#data").innerHTML = '';
            }
            
        </script>
    </head>
    <body>
        <h1>Using <code>audiobooks-js</code></h1>
        <p>Version <span id="version"></span></p>

        <p>Click "load" to load the sample file (or enter your own URL) and see the processed data output.</p>
        <input id="inputFile" value="http://localhost:8080/example/pub/manifest.json"></input>
        <button id="load">Load</button>

        <p>You can also pass in a URL to a manifest file like this: </p>
        <code>https://marisademeglio.github.io/audiobooks-js/example/<em>?q=https://w3c.github.io/publ-tests/test_content/audiobooks/Lang_Blue_Fairy_Book/index.html</em></code>

        <pre><code id="status" class="json"></code></pre>
        <pre><code id="data" class="json"></code></pre> 

    </body>
</html> 